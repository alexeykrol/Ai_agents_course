<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simple Chat UI (React + Tailwind)</title>
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React & ReactDOM (development builds) -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <!-- Babel for in-browser JSX transform (demo only) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useRef, useState } = React;

    function classNames(...arr) { return arr.filter(Boolean).join(' '); }

    const MOCK_NAMES = [
      { id: 'c1', name: 'Alice Johnson' },
      { id: 'c2', name: 'Dev Team' },
      { id: 'c3', name: 'Marketing' },
      { id: 'c4', name: 'Project Phoenix' },
      { id: 'c5', name: 'Support' },
    ];

    const INCOMING_SAMPLES = [
      'Got it, thanks!',
      'Can we move the meeting?',
      'Looks good to me.',
      'Sending the docs shortly.',
      'On it.',
      'Let’s ship today.',
      'Ping when ready.',
    ];

    function randItem(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

    function ChatApp() {
      const [activeId, setActiveId] = useState(MOCK_NAMES[0].id);
      const [messagesById, setMessagesById] = useState(() => {
        const seed = {
          c1: [
            { id: 1, sender: 'them', text: 'Hey! Ready to start?', ts: Date.now() - 600000 },
            { id: 2, sender: 'me', text: 'Yep, let’s go.', ts: Date.now() - 590000 },
          ],
          c2: [ { id: 1, sender: 'them', text: 'Sprint review at 4?', ts: Date.now() - 500000 } ],
          c3: [ { id: 1, sender: 'them', text: 'Campaign assets approved.', ts: Date.now() - 400000 } ],
          c4: [ { id: 1, sender: 'them', text: 'Phoenix deploy window opens 7pm.', ts: Date.now() - 300000 } ],
          c5: [ { id: 1, sender: 'them', text: 'Ticket #18231 escalated.', ts: Date.now() - 200000 } ],
        };
        return seed;
      });
      const [draft, setDraft] = useState('');
      const endRef = useRef(null);

      const activeMessages = messagesById[activeId] || [];

      // Auto-append incoming message every 5s for the active conversation
      useEffect(() => {
        const interval = setInterval(() => {
          setMessagesById((prev) => {
            const list = prev[activeId] || [];
            const next = {
              ...prev,
              [activeId]: [
                ...list,
                {
                  id: (list.at(-1)?.id || 0) + 1,
                  sender: 'them',
                  text: randItem(INCOMING_SAMPLES),
                  ts: Date.now(),
                },
              ],
            };
            return next;
          });
        }, 5000);
        return () => clearInterval(interval);
      }, [activeId]);

      // Scroll to bottom whenever messages change
      useEffect(() => {
        endRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [activeMessages.length, activeId]);

      const onSend = (e) => {
        e.preventDefault();
        const text = draft.trim();
        if (!text) return;
        setMessagesById((prev) => {
          const list = prev[activeId] || [];
          return {
            ...prev,
            [activeId]: [
              ...list,
              { id: (list.at(-1)?.id || 0) + 1, sender: 'me', text, ts: Date.now() },
            ],
          };
        });
        setDraft('');
      };

      return (
        <div className="h-screen flex">
          {/* Left panel */}
          <aside className="hidden sm:block w-64 border-r border-gray-200 bg-white">
            <div className="p-4 border-b border-gray-100">
              <h1 className="text-lg font-semibold">Conversations</h1>
            </div>
            <nav className="p-2 overflow-y-auto h-[calc(100vh-64px)]">
              {MOCK_NAMES.map((c) => (
                <button
                  key={c.id}
                  onClick={() => setActiveId(c.id)}
                  className={classNames(
                    'w-full text-left px-3 py-2 rounded-lg mb-1',
                    activeId === c.id ? 'bg-gray-900 text-white' : 'hover:bg-gray-100'
                  )}
                >
                  <div className="text-sm font-medium truncate">{c.name}</div>
                  <div className={classNames('text-xs', activeId === c.id ? 'text-white/80' : 'text-gray-500')}>Last message preview…</div>
                </button>
              ))}
            </nav>
          </aside>

          {/* Right panel */}
          <section className="flex-1 flex flex-col">
            {/* Top bar (with mobile conversation switcher) */}
            <div className="flex items-center justify-between px-4 h-14 border-b border-gray-200 bg-white">
              <div className="sm:hidden">
                <label htmlFor="conv" className="sr-only">Conversation</label>
                <select
                  id="conv"
                  value={activeId}
                  onChange={(e) => setActiveId(e.target.value)}
                  className="rounded-lg border border-gray-300 px-3 py-1.5 text-sm"
                >
                  {MOCK_NAMES.map((c) => (
                    <option key={c.id} value={c.id}>{c.name}</option>
                  ))}
                </select>
              </div>
              <div className="hidden sm:block text-sm text-gray-700">{MOCK_NAMES.find(x => x.id === activeId)?.name}</div>
              <div className="text-xs text-gray-500">Demo · no backend</div>
            </div>

            {/* Messages area */}
            <div className="flex-1 overflow-y-auto px-4 py-4">
              {activeMessages.map((m) => (
                <div key={m.id} className={classNames('mb-2 flex', m.sender === 'me' ? 'justify-end' : 'justify-start')}>
                  <div className={classNames(
                    'max-w-[80%] rounded-2xl px-3 py-2 text-sm shadow',
                    m.sender === 'me' ? 'bg-gray-900 text-white rounded-br-sm' : 'bg-white text-gray-900 border border-gray-200 rounded-bl-sm'
                  )}>
                    {m.text}
                  </div>
                </div>
              ))}
              <div ref={endRef} />
            </div>

            {/* Input (sticky at bottom) */}
            <form onSubmit={onSend} className="bg-white border-t border-gray-200 p-3 sticky bottom-0">
              <div className="flex items-center gap-2">
                <input
                  type="text"
                  value={draft}
                  onChange={(e) => setDraft(e.target.value)}
                  placeholder="Type a message…"
                  className="flex-1 rounded-xl border border-gray-300 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-black/10 focus:border-gray-400"
                />
                <button
                  type="submit"
                  className="rounded-xl bg-gray-900 text-white px-4 py-2 text-sm font-medium hover:bg-black focus:outline-none focus:ring-2 focus:ring-black/20"
                >
                  Send
                </button>
              </div>
            </form>
          </section>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<ChatApp />);
  </script>
</body>
</html>
